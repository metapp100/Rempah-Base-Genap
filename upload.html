<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spice Lens - Ambil Foto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:ital,wght@0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <style>
      /* ==================== 1. STYLE DASAR (SAMA DENGAN HOMEPAGE) ==================== */
      :root {
        --bg-header-footer: #4b4f36;
        --bg-content-green: #657649;
        --bg-hero-card: #4e5238;
        --text-light: #fffcf5;
        --text-dark: #333333;
        --accent-yellow: #eaddcf;
        --accent-gold: #f0e68c;
      }

      body {
        background-color: var(--bg-content-green);
        color: var(--text-light);
        font-family: "Montserrat", sans-serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      /* HEADER & NAV */
      .custom-header {
        width: 100%;
        padding: 15px 50px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: var(--bg-header-footer);
        z-index: 50;
        position: relative;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }
      .header-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-light);
        z-index: 51;
      }
      .header-logo i {
        font-size: 1.8rem;
        color: var(--accent-gold);
      }
      .nav-links {
        display: flex;
        gap: 30px;
        transition: 0.3s ease-in-out;
      }
      .custom-header a {
        color: var(--accent-yellow);
        text-decoration: none;
        font-size: 1rem;
        font-weight: 600;
        transition: color 0.2s ease-in-out;
      }
      .custom-header a:hover {
        color: #ffffff;
      }
      .hamburger {
        display: none;
        cursor: pointer;
        z-index: 51;
      }
      .hamburger i {
        font-size: 1.5rem;
        color: var(--accent-gold);
      }

      /* BACKGROUND */
      .hero-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2;
        background-image: url("image/leaf-pattern.png");
        background-size: cover;
        background-position: center;
        filter: grayscale(20%);
      }
      .hero-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(101, 118, 73, 0.65);
        z-index: -1;
      }

      /* MAIN CONTENT */
      .main-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
        text-align: center;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        z-index: 1;
      }

      .page-title {
        font-family: "Playfair Display", serif;
        font-size: 3rem;
        font-weight: 700;
        color: var(--accent-gold);
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
        margin-bottom: 10px;
      }
      .page-subtitle {
        font-size: 1rem;
        color: var(--text-light);
        margin-bottom: 30px;
        letter-spacing: 0.5px;
      }

      /* CONTAINER KAMERA */
      #container {
        position: relative;
        width: 100%;
        max-width: 600px;
        aspect-ratio: 4 / 3;
        background-color: #2a2a2a;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        margin-bottom: 30px;
        border: 4px solid var(--bg-header-footer);
      }
      #webcam,
      #canvasPreview,
      #imagePreview {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      #webcam {
        z-index: 10;
      }
      #imagePreview {
        z-index: 11;
        display: none;
      }
      #canvasPreview {
        z-index: 12;
        display: none;
      }

      /* BUTTONS */
      #button-area {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .action-button {
        display: inline-block;
        padding: 12px 30px;
        background-color: var(--accent-gold);
        color: #4b4f36;
        border-radius: 50px;
        font-size: 1rem;
        font-weight: 700;
        border: none;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }
      .action-button:hover:not(:disabled) {
        background-color: #fff;
        transform: translateY(-2px);
      }
      .action-button:disabled {
        background-color: #7a7a4f;
        color: #dcdcdc;
        cursor: not-allowed;
      }

      #loadingStatus {
        margin-top: 10px;
        font-size: 0.95rem;
        color: var(--accent-yellow);
        font-style: italic;
      }
      .info-text {
        font-size: 0.9rem;
        color: #dcdcdc;
        margin-bottom: 20px;
      }

      /* --- STYLE HASIL DETEKSI (BARU) --- */
      #detectionResult {
        background-color: var(--bg-hero-card); /* Latar belakang kartu gelap */
        padding: 30px;
        border-radius: 15px;
        margin-top: 20px;
        width: 100%;
        border: 1px solid var(--accent-gold);
        text-align: left;
        display: none; /* Hidden default */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        animation: fadeInUp 0.5s ease-out;
      }

      /* Style khusus untuk konten detail di dalam hasil */
      .detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .detail-title {
        font-family: "Playfair Display", serif;
        font-size: 2rem;
        color: var(--accent-gold);
        font-weight: 700;
      }
      .detail-score {
        background-color: var(--accent-yellow);
        color: #333;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
        font-size: 0.9rem;
      }
      .detail-latin {
        font-style: italic;
        color: #ccc;
        margin-bottom: 15px;
        display: block;
      }
      .detail-desc {
        font-size: 1rem;
        line-height: 1.6;
        color: #f0f0f0;
      }
      .detail-desc strong {
        color: var(--accent-yellow);
      }
      .detail-desc ul {
        list-style-type: disc;
        margin-left: 20px;
        margin-bottom: 10px;
      }

      /* Animasi */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* FOOTER & RESPONSIVE (SAMA) */
      .custom-footer {
        width: 100%;
        background-color: var(--bg-header-footer);
        padding: 30px 50px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
        color: #dcdcdc;
        font-size: 0.9rem;
      }
      .footer-logo {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--accent-gold);
        font-weight: bold;
        margin-right: 0;
        text-align: center;
      }
      .footer-logo i {
        font-size: 2rem;
        margin-bottom: 5px;
      }
      .footer-center-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .footer-icons a {
        color: white;
        margin: 0 10px;
        font-size: 1.5rem;
      }
      .footer-copyright {
        font-size: 0.85rem;
        color: #dcdcdc;
        text-align: center;
      }
      .footer-links {
        text-align: right;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .footer-links a {
        color: #dcdcdc;
        text-decoration: none;
      }
      .footer-links a:hover {
        color: var(--accent-gold);
      }

      @media (max-width: 768px) {
        .custom-header {
          padding: 15px 20px;
        }
        .hamburger {
          display: block;
        }
        .nav-links {
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background-color: var(--bg-header-footer);
          flex-direction: column;
          align-items: center;
          padding: 20px 0;
          gap: 20px;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          display: none;
        }
        .nav-links.active {
          display: flex;
        }
        .page-title {
          font-size: 2.2rem;
        }
        #container {
          aspect-ratio: 3 / 4;
          max-width: 100%;
        }
        .custom-footer {
          flex-direction: column;
          text-align: center;
          gap: 20px;
          padding: 20px;
        }
        .footer-logo,
        .footer-center-content,
        .footer-links {
          width: 100%;
          order: initial;
        }
        .footer-logo {
          order: 1;
        }
        .footer-center-content {
          order: 2;
        }
        .footer-links {
          order: 3;
          text-align: center;
        }
      }
    </style>
  </head>

  <body>
    <div class="hero-background"></div>
    <div class="hero-overlay"></div>

    <header class="custom-header">
      <div class="header-logo">
        <i class="fas fa-sun"></i> <span>Spice Lens</span>
      </div>
      <div class="hamburger" id="hamburger-menu">
        <i class="fas fa-bars"></i>
      </div>
      <nav class="nav-links" id="nav-menu">
        <a href="homepage.html">Beranda</a>
        <a href="about.html">Tentang Kami</a>
        <a href="fitur.html">Fitur</a>
        <a href="contact.html">Kontak</a>
      </nav>
    </header>

    <div class="main-content">
      <h1 class="page-title">Ambil Foto Rempah!</h1>
      <p class="page-subtitle">
        Arahkan kamera, ambil foto, dan biarkan model menjelaskan ciri-cirinya
      </p>

      <div id="container">
        <video
          id="webcam"
          playsinline
          muted
          autoplay
          style="display: none"
        ></video>
        <img id="imagePreview" src="" alt="Foto Rempah" style="display: none" />
        <canvas id="canvasPreview" style="display: none"></canvas>
      </div>

      <div id="button-area">
        <button id="startCameraBtn" class="action-button">Mulai Kamera</button>
        <button id="takePhotoBtn" class="action-button" style="display: none">
          <i class="fas fa-camera"></i> Ambil & Deteksi Rempah
        </button>
      </div>

      <div id="loadingStatus">
        Memuat model... (ini mungkin butuh beberapa detik)
      </div>
      <p class="info-text" id="infoText">Model deteksi rempah belum siap.</p>

      <div id="detectionResult"></div>
    </div>

    <footer class="custom-footer">
      <div class="footer-logo">
        <i class="fas fa-sun"></i> <span>Spice Lens</span>
      </div>
      <div class="footer-center-content">
        <div class="footer-icons">
          <a href="#"><i class="fab fa-x-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
        <p class="footer-copyright">
          Copyright 2025. Spice Lens. All Rights Reserved
        </p>
      </div>
      <div class="footer-links">
        <a href="homepage.html">Beranda</a>
        <a href="about.html">Tentang Kami</a>
        <a href="contact.html">Kontak</a>
      </div>
    </footer>

    <script>
      // === 1. NAVBAR SCRIPT ===
      const hamburger = document.getElementById("hamburger-menu");
      const navMenu = document.getElementById("nav-menu");
      const icon = hamburger.querySelector("i");
      hamburger.addEventListener("click", () => {
        navMenu.classList.toggle("active");
        if (navMenu.classList.contains("active")) {
          icon.classList.remove("fa-bars");
          icon.classList.add("fa-times");
        } else {
          icon.classList.remove("fa-times");
          icon.classList.add("fa-bars");
        }
      });

      // === 2. DATA REMPAH (SAMA DENGAN PAGE LAIN) ===
      const spiceData = {
        jahe: {
          title: "Jahe",
          latin: "Zingiber officinale",
          img: "rempah/Jahe.jpeg",
          desc: `
            <p>Jahe adalah tanaman herba tropis penghasil rimpang aromatik yang digunakan sebagai bumbu dan obat, dengan aroma kuat serta rasa pedas-hangat.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Rimpang bercabang, menggumpal, dan mematah tidak beraturan.</li>
              <li><strong>Warna:</strong> Bagian luar cokelat muda hingga tua; bagian dalam kekuningan.</li>
              <li><strong>Tekstur:</strong> Serat halus hingga kasar, daging rimpang padat dan berair.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <li><strong>Aroma:</strong>  Wangi hangat, pedas dan menyegarkan.</li>
            <li><strong>Rasa:</strong>  Pedas, hangat, sedikit pahit</li>
          `,
        },
        daun_salam: {
          title: "Daun Salam",
          latin: "Syzygium polyanthum",
          img: "rempah/Daun_Salam.jpeg",
          desc: `
            <p>Daun Salam adalah daun rempah populer di Indonesia yang digunakan untuk memberi aroma lembut pada berbagai masakan, terutama sup, tumisan, dan hidangan berkuah..</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Lonjong, ujung meruncing.</li>
              <li><strong>Warna:</strong> Hijau tua mengilap saat segar; cokelat saat kering.</li>
              <li><strong>Tekstur:</strong> Tipis, agak kaku, permukaan halus.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <li><strong>Aroma:</strong>  Lembut, hangat, khas rempah.</li>
            <li><strong>Rasa:</strong>  Tidak terlalu kuat, sedikit pahit-aromatis.</li>
          `,
        },
        kencur: {
          title: "Kencur",
          latin: "Kaempferia galanga",
          img: "rempah/kencur.jpeg",
          desc: `
          <p>Kencur memiliki aroma yang sangat khas dan segar, sering digunakan dalam masakan seblak atau jamu beras kencur.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Rimpang kecil-kecil, bulat atau lonjong, bergerombol.</li>
              <li><strong>Warna:</strong> Kulit cokelat gelap/kering; bagian dalam putih.</li>
              <li><strong>Tekstur:</strong> Daging lunak, mudah dipatahkan, tidak berserat kasar.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Sangat kuat, segar, dan menusuk (khas).</li>
              <li><strong>Rasa:</strong> Pedas hangat, sedikit getir, meninggalkan rasa tebal di lidah.</li>
            </ul>
          `,
        },
        lengkuas: {
          title: "Lengkuas",
          latin: "Alpinia galanga",
          img: "rempah/lengkuas.jpeg",
          desc: `
          <p>Lengkuas atau laos adalah rimpang yang sering digunakan untuk masakan bersantan atau tumisan, dikenal dengan teksturnya yang keras.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Rimpang besar, keras, dan bercabang.</li>
              <li><strong>Warna:</strong> Kulit cokelat muda; bagian dalam putih kemerahan/merah muda.</li>
              <li><strong>Tekstur:</strong> Keras, berserat kasar, sulit dipatahkan dengan tangan.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Segar, tajam, dan sedikit herbal (seperti sitrus/pinus).</li>
              <li><strong>Rasa:</strong> Pedas ringan, hangat, dan agak pahit.</li>
            </ul>
          `,
        },
        kunyit: {
          title: "Kunyit",
          latin: "Curcuma longa",
          img: "rempah/kunyit.jpeg",
          desc: `
          <p>Kunyit adalah rempah yang terkenal dengan warna kuning-oranye cerahnya. Selain sebagai pewarna alami, kunyit memiliki manfaat anti-inflamasi.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Rimpang silindris, bercabang-cabang.</li>
              <li><strong>Warna:</strong> Kulit jingga kecokelatan; daging dalam oranye terang.</li>
              <li><strong>Tekstur:</strong> Mudah dipatahkan, meninggalkan noda warna kuning.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Khas tanah (*earthy*), sedikit menyengat.</li>
              <li><strong>Rasa:</strong> Sedikit pahit, sepat, dan hangat.</li>
            </ul>
          `,
        },
        serai: {
          title: "Serai",
          latin: "Cymbopogon citratus",
          img: "rempah/serai.jpeg",
          desc: `
          <p>Serai atau sereh adalah tumbuhan rumput-rumputan yang dimanfaatkan batangnya untuk memberikan aroma segar pada masakan.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Batang panjang, berlapis-lapis seperti rumput besar.</li>
              <li><strong>Warna:</strong> Hijau pada daun, putih kekuningan pada pangkal batang.</li>
              <li><strong>Tekstur:</strong> Berserat, keras, dan kaku.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Sangat segar seperti lemon (*citrusy*).</li>
              <li><strong>Rasa:</strong> Sedikit pedas dan menyegarkan jika dimemarkan.</li>
            </ul>
          `,
        },
        biji_ketumbar: {
          title: "Biji Ketumbar",
          latin: "Coriandrum sativum",
          img: "rempah/Biji Ketumbar.jpeg",
          desc: `
          <p>Biji ketumbar adalah rempah biji-bijian kecil yang memberikan aroma hangat. Sering disangrai sebelum dihaluskan untuk memaksimalkan aroma.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Bulat kecil, bergaris-garis vertikal.</li>
              <li><strong>Warna:</strong> Cokelat muda kekuningan atau krem.</li>
              <li><strong>Tekstur:</strong> Keras namun mudah hancur jika digerus, kopong di dalam.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Harum, agak manis, dengan nuansa kayu dan jeruk.</li>
              <li><strong>Rasa:</strong> Gurih, hangat, sedikit rasa kulit jeruk.</li>
            </ul>
          `,
        },
        daun_jeruk: {
          title: "Daun Jeruk",
          latin: "Citrus hystrix",
          img: "rempah/daun_jeruk.webp",
          desc: `
          <p>Daun jeruk purut memiliki bentuk unik seperti angka 8. Aromanya sangat kuat dan segar, khas masakan Asia Tenggara.</p>
          <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Unik seperti angka 8 (dua helai daun yang tersambung).</li>
              <li><strong>Warna:</strong> Hijau tua pekat dan mengilap.</li>
              <li><strong>Tekstur:</strong> Tebal, licin, dan kaku.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Sangat kuat, segar, khas jeruk limau.</li>
              <li><strong>Rasa:</strong> Pahit jika dimakan langsung, namun menyegarkan.</li>
            </ul>
          `,
        },
        jinten: {
          title: "Jinten",
          latin: "Cuminum cyminum",
          img: "rempah/Jinten.jpeg",
          desc: `
          <p>Jinten berbentuk seperti biji padi kecil namun lebih gelap. Memiliki aroma kuat, pedas, dan sedikit manis.</p>
          <p>Jinten sering digunakan dalam bumbu kari, gulai, atau opor. Bentuknya mirip gabah padi namun ukurannya sangat kecil.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Lonjong kecil, pipih, dan lurus (mirip biji padi).</li>
              <li><strong>Warna:</strong> Cokelat kekuningan hingga abu-abu kecokelatan.</li>
              <li><strong>Tekstur:</strong> Keras, kering, bergaris halus.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Tajam, kuat, manis, dan musky.</li>
              <li><strong>Rasa:</strong> Pedas, pahit, dengan sensasi hangat yang kuat.</li>
            </ul>
          `,
        },
        kemiri: {
          title: "Kemiri",
          latin: "Aleurites moluccanus",
          img: "rempah/Kemiri.jpeg",
          desc: `
          <p>Kemiri digunakan untuk mengentalkan kuah masakan dan memberikan rasa gurih yang *creamy*.</p>
          <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Bulat agak gepeng, mirip kacang macadamia, berkerut.</li>
              <li><strong>Warna:</strong> Putih krem atau kekuningan.</li>
              <li><strong>Tekstur:</strong> Keras namun berminyak jika dihancurkan.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Lembut, samar, bau kacang mentah.</li>
              <li><strong>Rasa:</strong> Gurih, *creamy*, dan berlemak.</li>
            </ul>
          `,
        },
        pala: {
          title: "Pala",
          latin: "Myristica fragrans",
          img: "rempah/pala.jpeg",
          desc: `
          <p>Biji pala memberikan rasa hangat, manis, dan aromatik. Sering digunakan dalam sup, semur, dan juga kue.</p>
          <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Bulat lonjong seperti telur kecil, permukaan beralur.</li>
              <li><strong>Warna:</strong> Cokelat tua di luar, cokelat muda berurat di dalam.</li>
              <li><strong>Tekstur:</strong> Sangat keras dan padat.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Wangi manis, hangat, dan pedas.</li>
              <li><strong>Rasa:</strong> Manis, pedas, hangat, dan aromatik.</li>
            </ul>
          `,
        },
        lada: {
          title: "Lada",
          latin: "Piper nigrum",
          img: "rempah/lada.jpg",
          desc: `
          <p>Raja rempah-rempah yang memberikan rasa pedas dan panas pada masakan.</p>
          <p>Lada atau merica disebut sebagai "Raja Rempah", memberikan rasa pedas dan panas yang khas pada hampir semua jenis masakan.</p>
            <br>
            <strong style="color:var(--accent-gold)">Ciri - Ciri:</strong>
            <ul style="list-style-type: disc; margin-left: 20px; margin-top: 5px;">
              <li><strong>Bentuk:</strong> Bulat kecil-kecil, permukaan keriput.</li>
              <li><strong>Warna:</strong> Hitam (lada hitam) atau Putih kekuningan (lada putih).</li>
              <li><strong>Tekstur:</strong> Keras dan kering.</li>
            </ul>
            <br>
            <strong style="color:var(--accent-gold)">Aroma & Rasa:</strong>
            <ul style="list-style-type: none; margin-top: 5px;">
              <li><strong>Aroma:</strong> Tajam, menusuk hidung, membuat bersin.</li>
              <li><strong>Rasa:</strong> Pedas panas dan membakar di lidah.</li>
            </ul>
          `,
        },
      };

      // === 3. LOGIKA DETEKSI ===
      const NAMA_KELAS = [
        "Biji Ketumbar",
        "Daun Jeruk",
        "Daun Salam",
        "Jahe",
        "Jinten",
        "Kemiri",
        "Kencur",
        "Kunyit",
        "Lada",
        "Lengkuas",
        "Pala",
        "Serai",
      ];
      const MODEL_INPUT_SIZE = 640;
      const CONFIDENCE_THRESHOLD = 0.5;
      const IOU_THRESHOLD = 0.5;
      const MODEL_PATH = "best_web_model/model.json";

      const video = document.getElementById("webcam");
      const imagePreview = document.getElementById("imagePreview");
      const canvas = document.getElementById("canvasPreview");
      const ctx = canvas.getContext("2d");
      const startCameraBtn = document.getElementById("startCameraBtn");
      const takePhotoBtn = document.getElementById("takePhotoBtn");
      const loadingStatus = document.getElementById("loadingStatus");
      const infoText = document.getElementById("infoText");
      const detectionResultDiv = document.getElementById("detectionResult");

      let model;
      let mediaStream = null;

      async function loadModel() {
        loadingStatus.innerText =
          "Memuat model... (ini mungkin butuh beberapa detik)";
        startCameraBtn.disabled = true;
        try {
          model = await tf.loadGraphModel(MODEL_PATH);
          const warmUpTensor = tf.zeros([
            1,
            MODEL_INPUT_SIZE,
            MODEL_INPUT_SIZE,
            3,
          ]);
          await model.executeAsync(warmUpTensor);
          tf.dispose(warmUpTensor);
          loadingStatus.innerText = "âœ… Model Siap! Klik 'Mulai Kamera'.";
          startCameraBtn.disabled = false;
          infoText.innerText = "Model deteksi rempah siap digunakan.";
        } catch (err) {
          console.error("Gagal memuat model:", err);
          loadingStatus.innerText = "âŒ Error: Gagal memuat model.";
        }
      }

      async function startCamera() {
        if (!model) return;
        detectionResultDiv.style.display = "none";
        canvas.style.display = "none";
        imagePreview.style.display = "none";
        takePhotoBtn.disabled = true;

        try {
          if (mediaStream)
            mediaStream.getTracks().forEach((track) => track.stop());
          mediaStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false,
          });
          video.srcObject = mediaStream;
          video.onloadedmetadata = async () => {
            await video.play();
            video.style.display = "block";
            startCameraBtn.style.display = "none";
            takePhotoBtn.style.display = "inline-block";
            takePhotoBtn.disabled = false;
            infoText.innerText =
              "Kamera aktif. Arahkan dan klik 'Ambil & Deteksi'.";
          };
        } catch (err) {
          console.error(err);
          alert("Gagal mengakses webcam.");
        }
      }

      async function takePhotoAndDetect() {
        if (!model || !mediaStream) return;
        takePhotoBtn.disabled = true;
        infoText.innerText = "ðŸ“· Memproses gambar...";

        const tempCanvas = document.createElement("canvas");
        tempCanvas.width = video.videoWidth;
        tempCanvas.height = video.videoHeight;
        const tempCtx = tempCanvas.getContext("2d");
        tempCtx.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height);

        mediaStream.getTracks().forEach((track) => track.stop());
        video.style.display = "none";
        imagePreview.src = tempCanvas.toDataURL("image/jpeg");
        imagePreview.style.display = "block";
        canvas.style.display = "block";

        imagePreview.onload = async () => {
          canvas.width = imagePreview.clientWidth;
          canvas.height = imagePreview.clientHeight;
          await runInferenceOnImage(tempCanvas);
          startCameraBtn.style.display = "inline-block";
          takePhotoBtn.style.display = "none";
          startCameraBtn.innerText = "Ambil Foto Lagi";
          startCameraBtn.disabled = false;
          infoText.innerText = "Selesai.";
        };
      }

      async function runInferenceOnImage(imageElement) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const inputTensor = tf.browser
          .fromPixels(imageElement)
          .resizeBilinear([MODEL_INPUT_SIZE, MODEL_INPUT_SIZE])
          .cast("float32")
          .div(255.0)
          .expandDims(0);
        const outputTensor = model.execute(inputTensor);
        const transposedOutput = outputTensor.transpose([0, 2, 1]);
        const finalDetections = await processOutput(transposedOutput);

        // Tampilkan Hasil + Info Detail
        displayResults(finalDetections);
        drawDetections(finalDetections);
        tf.dispose([inputTensor, outputTensor, transposedOutput]);
      }

      async function processOutput(transposedOutput) {
        const numBoxes = transposedOutput.shape[1];
        const numClasses = NAMA_KELAS.length;
        const outputData = await transposedOutput.data();
        tf.dispose(transposedOutput);

        let boxes = [],
          scores = [],
          classIndices = [];
        for (let i = 0; i < numBoxes; i++) {
          const offset = i * (4 + numClasses);
          const classScores = outputData.slice(
            offset + 4,
            offset + 4 + numClasses
          );
          let maxScore = 0,
            maxClassIndex = -1;
          for (let j = 0; j < numClasses; j++) {
            if (classScores[j] > maxScore) {
              maxScore = classScores[j];
              maxClassIndex = j;
            }
          }
          if (maxScore > CONFIDENCE_THRESHOLD) {
            const cx = outputData[offset],
              cy = outputData[offset + 1],
              w = outputData[offset + 2],
              h = outputData[offset + 3];
            boxes.push([
              (cy - h / 2) / MODEL_INPUT_SIZE,
              (cx - w / 2) / MODEL_INPUT_SIZE,
              (cy + h / 2) / MODEL_INPUT_SIZE,
              (cx + w / 2) / MODEL_INPUT_SIZE,
            ]);
            scores.push(maxScore);
            classIndices.push(maxClassIndex);
          }
        }
        if (boxes.length === 0) return [];
        const boxTensors = tf.tensor2d(boxes);
        const scoreTensors = tf.tensor1d(scores);
        const selectedIndices = await tf.image.nonMaxSuppressionAsync(
          boxTensors,
          scoreTensors,
          100,
          IOU_THRESHOLD,
          CONFIDENCE_THRESHOLD
        );
        const selectedIndicesData = await selectedIndices.data();
        const finalBoxes = [];
        for (let i = 0; i < selectedIndicesData.length; i++) {
          const index = selectedIndicesData[i];
          finalBoxes.push({
            box: boxes[index],
            score: scores[index],
            classIndex: classIndices[index],
          });
        }
        tf.dispose([boxTensors, scoreTensors, selectedIndices]);
        return finalBoxes;
      }

      // --- FUNGSI UTAMA UNTUK MENAMPILKAN DETAIL INFO ---
      function displayResults(detections) {
        detectionResultDiv.style.display = "block";

        if (detections.length === 0) {
          detectionResultDiv.innerHTML =
            "<p style='text-align:center;'>Tidak ada rempah yang terdeteksi.</p>";
          return;
        }

        // 1. Cari deteksi dengan skor tertinggi
        let bestDetection = detections[0];
        detections.forEach((d) => {
          if (d.score > bestDetection.score) bestDetection = d;
        });

        // 2. Ambil Nama Label dan Key untuk Data
        const labelName = NAMA_KELAS[bestDetection.classIndex];
        // Ubah "Daun Jeruk" -> "daun_jeruk" untuk akses spiceData
        const dataKey = labelName.toLowerCase().replace(/ /g, "_");
        const info = spiceData[dataKey];

        // 3. Bangun HTML Detail
        let htmlContent = `
            <div class="detail-header">
                <span class="detail-title">${labelName}</span>
                <span class="detail-score">Akurasi: ${(
                  bestDetection.score * 100
                ).toFixed(1)}%</span>
            </div>
        `;

        if (info) {
          htmlContent += `
                <span class="detail-latin">${info.latin}</span>
                <div class="detail-desc">${info.desc}</div>
            `;
        } else {
          htmlContent += `<p>Informasi detail untuk rempah ini belum tersedia di database.</p>`;
        }

        // Tampilkan di container
        detectionResultDiv.innerHTML = htmlContent;
      }

      function drawDetections(boxes) {
        boxes.forEach((boxData) => {
          const [y1, x1, y2, x2] = boxData.box;
          const x = x1 * canvas.width,
            y = y1 * canvas.height,
            w = (x2 - x1) * canvas.width,
            h = (y2 - y1) * canvas.height;
          ctx.strokeStyle = "#FFD700";
          ctx.lineWidth = 3;
          ctx.strokeRect(x, y, w, h);
          ctx.fillStyle = "#FFD700";
          ctx.font = "600 18px Montserrat";
          const text = `${NAMA_KELAS[boxData.classIndex]} (${(
            boxData.score * 100
          ).toFixed(0)}%)`;
          const textWidth = ctx.measureText(text).width;
          const textY = y > 24 ? y - 24 : y + h + 5;
          ctx.fillRect(x, textY, textWidth + 8, 24);
          ctx.fillStyle = "#000000";
          ctx.fillText(text, x + 4, textY + 18);
        });
      }

      startCameraBtn.addEventListener("click", startCamera);
      takePhotoBtn.addEventListener("click", takePhotoAndDetect);
      loadModel();
    </script>
  </body>
</html>
